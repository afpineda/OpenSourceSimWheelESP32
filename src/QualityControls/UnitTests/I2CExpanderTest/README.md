# Unit test: Input from GPIO expanders

## Purpose and summary

To test correct identification of events caused by GPIO expanders.

## Hardware setup

Use the following [test circuit](../../Protoboards/TestBoard2.diy).
Just the GPIO expanders are used.

![Test circuit image](../../Protoboards/TestBoard2.png)

This test circuit does not have micro-switches attached to the GPIO expanders due to its excessive number.
Two wires will replace them.
For future reference, those wires are called "probe1" and "probe2".
You have to manually wire/unwire them to/from the requested pin to close/open the circuit.

## Procedure and expected output

### Part 1: mask

1. Reset. Ignore output from the operating system itself.

2. The latest 3 lines of output must match:

   ```text
   MASK:
   1111111111111111111111111100000000110000000011000000001111111111
   -- GO --
   ```

3. Wait for 30 seconds or so. There must be no further output.

### Part 2: single button identification

1. One at a time, wire and unwire "probe1" to one *PCF8574's* GPIO, in the following order:
   P0, P1, P2, P3, P4, P5, P6, P7. Output must match:

   ```text
   0000000000000000000000000000000001000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000010000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000100000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000001000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000010000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000100000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000001000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000010000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   ```

2. One at a time, wire and unwire "probe1" to one *MCP23017's* GPIO, in the following order:
   GPA0, GPA1, GPA2, GPA3, GPA4, GPA5, GPA6, GPA7, GPB0, GPB1, GPB2, GPB3, GPB4, GPB5, GPB6, GPB7.
   Output must match:

   ```text
   0000000000000000000000000000000000000000000000000000010000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000000100000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000001000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000010000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000000100000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000001000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000010000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000000100000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000000100000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000001000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000010000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000000100000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000001000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000010000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000000100000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   0000000000000000000000000000000000001000000000000000000000000000
   0000000000000000000000000000000000000000000000000000000000000000
   ```

### Part 2: input identification from many buttons

1. Wire "probe1" to GPA0 and "probe2" to GPB7. Last output line must show:

   ```text
   0000000000000000000000000000000000001000000000000000010000000000
   ```

2. Unwire both "probe1" and "probe2". Ignore output.
3. Wire "probe1" to P0 and "probe2" to P7. Last output line must show:

   ```text
   0000000000000000000000000010000001000000000000000000000000000000
   ```

4. Unwire both "probe1" and "probe2". Ignore output.
5. Wire "probe1" to P1 and "probe2" to GPA1. Last output line must show:

   ```text
   0000000000000000000000000000000010000000000000000000100000000000
   ```
