# Integration test: combined input from several buttons and a rotary enconder

## Purpose and summary

To test correct identification and combination of events caused by different kinds of inputs.
Individual events are combined into a global state bitmap (one bit for each input).

## Hardware setup

Actual GPIO numbers are defined at [debugUtils.h](./debugUtils.h).

Rotary encoder:

- KY-O40 type (with external pull-up resistors)
- `CLK` pin attached to `TEST_ROTARY_CLK`
- `DT` pin attached to `TEST_ROTARY_DT`
- `SW` pin attached to `TEST_ROTARY_SW`. Alternatively, a single push button can be used, as long as it uses an external pull-up resistor.

Button Matrix (6 buttons): same setup as the [Button Matrix unit test](../../UnitTests/ButtonMatrixTest/README.md)

Output through USB serial port at 115200 bauds.

For later reference:

- "L1" is the button in the matrix whose output is:
  
  ```
  STATE : 0000000000000000000000000000000000000000000000000000000000000001
  ```
- "D1" is the push button integrated in the rotary encoder.
- "RCW" means rotary clockwise rotation.
- "RCCW" means rotary counter-clockwise rotation.

## Procedure and expected output

1. Reset
2. On start, output must match the following:
   
   ```
   -- READY --
   -- GO --
   ```
3. Press and hold D1, then press and hold L1, then release D1, then release L1. Output must match the following:
   
   ```
   STATE : 0000000000000000000000000000000000000000000000000000000001000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000001000000
   STATE : 0000000000000000000000000000000000000000000000000000000001000001
   CHANGE: 0000000000000000000000000000000000000000000000000000000000000001
   STATE : 0000000000000000000000000000000000000000000000000000000000000001
   CHANGE: 0000000000000000000000000000000000000000000000000000000001000000
   STATE : 0000000000000000000000000000000000000000000000000000000000000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000000000001
   ```
4. Input RCW one detent, then RCCW one detent. Output must match the following:
   
   ```
   STATE : 0000000000000000000000000000000000000000000000000000000010000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000010000000
   STATE : 0000000000000000000000000000000000000000000000000000000000000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000010000000
   STATE : 0000000000000000000000000000000000000000000000000000000100000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000100000000
   STATE : 0000000000000000000000000000000000000000000000000000000000000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000100000000
   ```
5. Press and hold D1, input RCW one detent, then RCCW one detent, then release D1. Output must match the following:
   
   ```
   STATE : 0000000000000000000000000000000000000000000000000000000001000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000001000000
   STATE : 0000000000000000000000000000000000000000000000000000000011000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000010000000
   STATE : 0000000000000000000000000000000000000000000000000000000001000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000010000000
   STATE : 0000000000000000000000000000000000000000000000000000000101000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000100000000
   STATE : 0000000000000000000000000000000000000000000000000000000001000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000100000000
   STATE : 0000000000000000000000000000000000000000000000000000000000000000
   CHANGE: 0000000000000000000000000000000000000000000000000000000001000000
   ```
